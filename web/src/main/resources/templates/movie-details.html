<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/animate.css">
    <link rel="stylesheet" href="../assets/css/flaticon.css">
    <link rel="stylesheet" href="../assets/css/magnific-popup.css">
    <link rel="stylesheet" href="../assets/css/odometer.css">
    <link rel="stylesheet" href="../assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../assets/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="../assets/css/nice-select.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="shortcut icon" href="../assets/images/favicon.png" type="image/x-icon">
    <title>Boleto - Online Ticket Booking Website HTML Template</title></head>

<body><!-- ==========Preloader========== -->
<div class="preloader">
    <div class="preloader-inner">
        <div class="preloader-icon"><span></span><span></span></div>
    </div>
</div><!-- ==========Preloader========== --><!-- ==========Overlay========== -->
<div class="overlay"></div>
<a href="#0" class="scrollToTop"><i class="fas fa-angle-up"></i></a><!-- ==========Overlay========== -->
<!-- ==========Header-Section========== -->
<header class="header-section">
    <div th:include="/fragments/top-part:: top"></div>

</header><!-- ==========Header-Section========== --><!-- ==========Banner-Section========== -->
<section class="details-banner bg_img">
    <div class="container">
        <div class="details-banner-wrapper">
            <div class="details-banner-thumb"><img style="width: 260px; height: 150px"
                                                   th:src="@{/movieImage(movieUrl=${movie.getPicUrl()})}" alt="movie"><a
                    th:href="${movie.getThriller()}" class="video-popup"><img
                    src="../assets/images/movie/video-button.png" alt="movie"></a></div>
            <div class="details-banner-content offset-lg-3"><h3 class="title" th:text="${movie.name}"></h3>
                <div class="tags"><a th:text="${movie.getLanguage()}"></a>
                </div>
                <a class="button" id="category" th:value="${movie.getCategory()}" th:text="${movie.getCategory()}"></a>
                <div class="social-and-duration">
                    <div class="duration-area">
                        <div class="item"><i class="far fa-clock"></i><span th:text="${movie.getDuration()}"></span>
                        </div>
                    </div>
                    <ul class="social-share">
                        <li><a href="#0"><i class="fab fa-facebook-f"></i></a></li>
                        <li><a href="#0"><i class="fab fa-twitter"></i></a></li>
                        <li><a href="#0"><i class="fab fa-pinterest-p"></i></a></li>
                        <li><a href="#0"><i class="fab fa-linkedin-in"></i></a></li>
                        <li><a href="#0"><i class="fab fa-google-plus-g"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section><!-- ==========Banner-Section========== --><!-- ==========Book-Section========== -->
<section class="book-section bg-one">
    <div class="container">
        <div class="book-wrapper offset-lg-3">
            <div class="left-side">

                <div class="item">
                    <div class="item-header">
                        <form th:action="@{/user/updateMovieRating(id=${movie.getId()})}" method="post">
                            <div class="rating-area">
                                <input type="submit" id="star-5" name="rating" value=5>
                                <label for="star-5" title="Оценка «5»"></label>
                                <input type="submit" id="star-4" name="rating" value="4">
                                <label for="star-4" title="Оценка «4»"></label>
                                <input type="submit" id="star-3" name="rating" value="3">
                                <label for="star-3" title="Оценка «3»"></label>
                                <input type="submit" id="star-2" name="rating" value="2">
                                <label for="star-2" title="Оценка «2»"></label>
                                <input type="submit" id="star-1" name="rating" value="1">
                                <label for="star-1" title="Оценка «1»"></label>
                            </div>
                        </form>

                        <h5 class="title" th:text="${movie.getRating()}"></h5></div>
                    <p>Movie Rating</p></div>
            </div>
            <a  if="" th:style="${movie.getSeanceDateTime().size()==0?'display: none':'display: auto'}" th:href="@{/user/bookTicket(movieId=${movie.getId()})}" class="custom-button">book tickets</a></div>
    </div>
</section><!-- ==========Book-Section========== --><!-- ==========Movie-Section========== -->
<section class="movie-details-section padding-top padding-bottom">
    <div class="container">
        <div class="row justify-content-center flex-wrap-reverse mb--50">

            <div class="col-lg-9 mb-50">
                <div class="movie-details"><h3 class="title">photos</h3>
                    <div class="details-photos owl-carousel" th:each="photo:${movie.getPicUrls()}">
                        <div class="thumb"><a th:href="@{/movieImage(movieUrl=${photo})}" class="img-pop"><img
                                th:src="@{/movieImage(movieUrl=${photo})}" alt="movie"></a></div>
                    </div>
                    <div class="tab summery-review">
                        <ul class="tab-menu">
                            <li class="active">actors</li>
                            <li>comments<span>147</span></li>
                        </ul>
                        <div class="tab-area">
                            <div class="tab-item active">
                                <div class="item"><h5 class="sub-title">Description</h5>
                                    <p th:text="${movie.getDescription()}"></p></div>
                                <div class="item">
                                    <div class="header"><h5 class="sub-title">Actors</h5>
                                        <li class="header-button pr-0" th:style="${user==null || user.getUser().getUserType().name()=='USER' ?'display:none':'display:auto'}"><a th:href="@{/admin/addActors(movieId=${movie.getId()})}">add actor</a></li>

                                        <div class="navigation">
                                            <div class="cast-prev"><i class="flaticon-double-right-arrows-angles"></i>
                                            </div>
                                            <div class="cast-next"><i class="flaticon-double-right-arrows-angles"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="casting-slider owl-carousel" >
                                        <div class="cast-item" th:each="actor:${movie.getActor()}">
                                            <div class="cast-thumb"><a th:href="@{/actorDetails(actorId=${actor.id},movieId=${movie.id})}"><img style="height: 109px"
                                                    th:src="@{/actorImg(actorUrl=${actor.picUrl})}" alt="cast"></a></div>
                                            <div class="cast-content"><h6 class="cast-title" th:text="${actor.name+' '+actor.surname}"><a th:href="@{/actorDetails(actorId=${actor.id})}">Bill Hader</a>
                                            </h6></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="item">

                                </div>
                            </div>


                            <!--comment-->
                            <div class="tab-item">
                                <h6>add comments</h6>
                                <form action="/user/addComment" method="post">
                                    <input type="text" placeholder="enter your comment" name="text">
                                    <input type="hidden" name="movieId" th:value="${movie.getId()}">
                                    <input type="submit" value="add comment">
                                </form>


                                <div class="movie-review-item" th:each="comment : ${comments.content}">
                                    <div class="author">
                                        <div class="thumb"><a href="#0"><img src="../assets/images/cast/cast02.jpg"
                                                                             alt="cast"></a></div>
                                        <div class="movie-review-info"><h6 class="subtitle"
                                                                           th:text="${comment.user.getName +  ' ' + comment.user.getSurname()}"></h6>
                                        </div>
                                    </div>
                                    <div class="movie-review-content">
                                        <div><span th:text="${comment.getText()}"></span></div>
                                        <div class="review-meta">

                                            <a onclick="return false;" th:href="${comment.getId()}"
                                               class="flaticon-hand">
                                                    <span th:id="${'comment' + comment.id}"
                                                          th:text="${comment.getLikes().size()}"></span></a>

                                            <a class="flaticon-dont-like-symbol"
                                               onclick="return false;" th:href="${comment.getId()}">
                                            <span
                                                    th:id="${'dislike' + comment.id}"
                                                    th:text="${comment.getDislikes().size()}"></span></a>
                                           </div>
                                        <form action="/user/deleteComment" method="get">
                                            <input type="hidden" name="id" th:value="${comment.getId()}">
                                            <input type="hidden" name="movieId"
                                                   th:value="${comment.getMovie().getId()}">
                                            <input th:type="${user.getUser().getUserType().name=='ADMIN' || user.getUser().getUserType()==comment.getUser().getUserType()?'submit':'hidden'}" value="delete"></input>

                                        </form>

                                    </div>
                                </div>

                                <div th:if="${comments.totalPages>0}" class="pagination-area text-center">
                                    <a th:each="page:${pageNumbers}"
                                       th:href="@{/movieDetails(id=${movie.id}, size=${comments.size}, page=${(page-1)})}"
                                       th:text="${page}"
                                       th:class="${page==comments.number+1} ? active"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section> <!--==========Movie-Section==========  ==========Newslater-Section========== -->
<footer class="footer-section">
    <div class="newslater-section padding-bottom">
        <div class="container">
            <div class="newslater-container bg_img" data-background="./assets/images/newslater/newslater-bg01.jpg">
                <div class="newslater-wrapper"><h5 class="cate">subscribe to Boleto</h5>
                    <h3 class="title">to get exclusive benifits</h3>
                    <form class="newslater-form"><input type="text" placeholder="Your Email Address">
                        <button type="submit">subscribe</button>
                    </form>
                    <p>We respect your privacy, so we never share your info</p></div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="footer-top">
            <div class="logo"><a href="/"><img src="../assets/images/footer/footer-logo.png" alt="footer"></a>
            </div>
            <ul class="social-icons">
                <li><a href="https://www.facebook.com/"><i class="fab fa-facebook-f"></i></a></li>
                <li><a href="https://twitter.com/?lang=ru" class="active"><i class="fab fa-twitter"></i></a></li>
                <li><a href="https://www.pinterest.com/"><i class="fab fa-pinterest-p"></i></a></li>
                <li><a href="https://www.google.ru/"><i class="fab fa-google"></i></a></li>
                <li><a href="https://www.instagram.com/?hl=ru"><i class="fab fa-instagram"></i></a></li>
            </ul>
        </div>
        <div class="footer-bottom">
            <div class="footer-bottom-area">
                <div class="left"><p>Copyright © 2020.All Rights Reserved By <a href="http://www.bootstrapmb.com/">Boleto </a>
                </p></div>
                <ul class="links">
                    <li><a href="/about">About</a></li>
                    <li><a href="#0">Privacy Policy</a></li>
                    <li><a href="#0">FAQ</a></li>
                    <li><a href="#0">Feedback</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer><!-- ==========Newslater-Section========== -->
<script src="../assets/js/jquery-3.3.1.min.js"></script>
<script src="../assets/js/modernizr-3.6.0.min.js"></script>
<script src="../assets/js/plugins.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/isotope.pkgd.min.js"></script>
<script src="../assets/js/magnific-popup.min.js"></script>
<script src="../assets/js/owl.carousel.min.js"></script>
<script src="../assets/js/wow.min.js"></script>
<script src="../assets/js/countdown.min.js"></script>
<script src="../assets/js/odometer.min.js"></script>
<script src="../assets/js/viewport.jquery.js"></script>
<script src="../assets/js/nice-select.js"></script>
<script src="../assets/js/main.js"></script>
<script>
    $('#category').click(function () {
        let val = $(this).text();

        window.location.href = 'http://localhost:8080/viewAll?category=' + val;
    });

    $('#like').click(function () {
        $('#likeCount').remove().append(
            `<span>5</span>
            `
        )
    })

    $('.flaticon-hand').click(function () {
        var href = $(this).attr('href');
        console.log(href);
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'GET',
            url: '/updateLikes?commentId=' + href,
            data: JSON.stringify(href),
            success: function (data) {
                console.log(data)
                let like = $('#comment' + href).text();
                console.log(like)
                $('#comment' + href).text(data ? + like + 1 : + like - 1)

            }
        });
    })

    $('.flaticon-dont-like-symbol').click(function () {
        var href = $(this).attr('href');
        console.log(href);
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'GET',
            url: '/updateDislikes?commentId=' + href,
            data: JSON.stringify(href),
            success: function (data) {
                let dislike = $('#dislike' + href).text();
                console.log(dislike)
                $('#dislike' + href).text(data ? +dislike + 1 : +dislike - 1)

            }
        });
    })

</script>
</body>
</html>